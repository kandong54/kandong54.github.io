"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[103],{9103:(z,m,s)=>{s.r(m),s.d(m,{CameraModule:()=>l});var u=s(6895),c=s(3456),g=s(5861),i=s(4650),x=s(3411);const C=["myCanvas"];class r{constructor(t,e){this.clientService=t,this.router=e,this.imageWidth=0,this.imageHeight=0,this.imageStream=null,this.lastTime=0,this.context2D=null,this.myCanvas={},this.interval=100}ngOnInit(){this.clientService.connect().then(t=>console.log("Connect result:",t)).catch(t=>{alert("Connection error: "+t),this.router.navigate(["/login"])})}updateFps(){let t=Date.now(),e=t-this.lastTime;this.lastTime=t,this.interval=.95*this.interval+e*(1-.95)}handleCamera(t){this.updateFps();let e=t.getImage_asU8(),n=t.getBoxList(),a=new Image,y=new Blob([e],{type:"image/jpeg"});a.src=URL.createObjectURL(y),a.onload=()=>{if(null!==this.context2D){this.context2D.drawImage(a,0,0,this.imageWidth,this.imageHeight,0,0,this.context2D.canvas.width,this.context2D.canvas.height),this.context2D.fillText("FPS: "+(1e3/this.interval).toFixed(2),10,50);for(const o of n){let d=o.getLeft(),f=o.getTop(),w=o.getWidth(),v=o.getHeight();this.context2D.strokeRect(d,f,w,v);let D=o.getConfidence(),S=o.getDepth();this.context2D.fillText(Math.round(100*D)+"% "+Math.round(S)+"cm",d+5,f+v-6)}URL.revokeObjectURL(a.src)}}}resizeCanvas(t,e){let n=window.innerWidth,a=window.innerHeight-t.offsetTop;n/a>e?(t.style.width=Math.floor(a*e)+"px",t.style.height=a+"px"):(t.style.height=Math.floor(n/e)+"px",t.style.width=n+"px")}getImageSize(){var t=this;return(0,g.Z)(function*(){let e=yield t.clientService.getImageSize();if(null===e)throw new Error("Failed to get image size!");[t.imageWidth,t.imageHeight]=e,t.myCanvas.nativeElement.width=t.imageWidth,t.myCanvas.nativeElement.height=t.imageHeight,t.resizeCanvas(t.myCanvas.nativeElement,t.imageWidth/t.imageHeight),window.addEventListener("resize",()=>t.resizeCanvas(t.myCanvas.nativeElement,t.imageWidth/t.imageHeight))})()}ngAfterViewInit(){var t=this;return(0,g.Z)(function*(){yield t.getImageSize(),t.context2D=t.myCanvas.nativeElement.getContext("2d"),t.context2D&&(t.context2D.strokeStyle="red",t.context2D.lineWidth=3,t.context2D.font="48px Roboto",t.context2D.shadowColor="white",t.context2D.shadowBlur=3,t.context2D.shadowOffsetX=1,t.context2D.shadowOffsetY=1),t.imageStream=t.clientService.getCamera(),null!==t.imageStream?(t.imageStream.on("error",e=>alert("Connection error: "+e)),t.imageStream.on("end",()=>alert("Connection ends.")),t.imageStream.on("data",e=>t.handleCamera(e)),t.lastTime=Date.now()):alert("Failed to get camera data!")})()}static#t=this.\u0275fac=function(e){return new(e||r)(i.Y36(x.y),i.Y36(c.F0))};static#e=this.\u0275cmp=i.Xpm({type:r,selectors:[["app-camera"]],viewQuery:function(e,n){if(1&e&&i.Gf(C,5),2&e){let a;i.iGM(a=i.CRH())&&(n.myCanvas=a.first)}},decls:2,vars:0,consts:[[1,"center"],["myCanvas",""]],template:function(e,n){1&e&&i._UZ(0,"canvas",0,1)},styles:[".center[_ngcontent-%COMP%]{position:fixed;border:1px solid;left:50%;transform:translate(-50%)}"]})}const p=[{path:"",component:r}];class h{static#t=this.\u0275fac=function(e){return new(e||h)};static#e=this.\u0275mod=i.oAB({type:h});static#i=this.\u0275inj=i.cJS({imports:[c.Bz.forChild(p),c.Bz]})}class l{static#t=this.\u0275fac=function(e){return new(e||l)};static#e=this.\u0275mod=i.oAB({type:l});static#i=this.\u0275inj=i.cJS({imports:[u.ez,h]})}}}]);