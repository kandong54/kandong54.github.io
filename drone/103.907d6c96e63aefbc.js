"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[103],{9103:(w,m,s)=>{s.r(m),s.d(m,{CameraModule:()=>y});var d=s(9808),c=s(4100),a=s(5e3),C=s(4398);const f=["myCanvas"],p=[{path:"",component:(()=>{class e{constructor(t,n){this.clientService=t,this.router=n,this.imageStream=null,this.context2D=null,this.myCanvas={},this.cameraWidth=960,this.cameraHeight=720,this.imageWidth=640,this.imageHeight=640,this.interval=230,this.lastTime=Date.now()}ngOnInit(){this.clientService.connect().then(t=>{console.log("Connect result:",t)}).catch(t=>{alert("Connection error: "+t),this.router.navigate(["/login"])})}updateFps(){let t=Date.now(),n=t-this.lastTime;this.lastTime=t,this.interval=.9*this.interval+n*(1-.9)}handleCamera(t){this.updateFps();let n=t.getImage_asU8(),o=t.getBoxList(),l=new Image,x=new Blob([n],{type:"image/jpeg"});l.src=URL.createObjectURL(x),l.onload=()=>{if(null!==this.context2D){this.context2D.drawImage(l,0,0,this.imageWidth,this.imageHeight,0,0,this.cameraWidth,this.cameraHeight),this.context2D.fillText("FPS: "+(1e3/this.interval).toFixed(2),10,50);for(const r of o){let h=r.getLeft(),g=r.getTop(),S=r.getWidth(),u=r.getHeight();this.context2D.strokeRect(h,g,S,u);let D=r.getConfidence();this.context2D.fillText(Math.round(100*D)+"%",h,g+u)}URL.revokeObjectURL(l.src)}}}ngAfterViewInit(){this.myCanvas.nativeElement.width=this.cameraWidth,this.myCanvas.nativeElement.height=this.cameraHeight,this.context2D=this.myCanvas.nativeElement.getContext("2d"),this.context2D&&(this.context2D.strokeStyle="red",this.context2D.font="48px Roboto"),this.imageStream=this.clientService.getCamera(),null!==this.imageStream?(this.imageStream.on("error",t=>alert("Connection error: "+t)),this.imageStream.on("end",()=>alert("Connection ends.")),this.imageStream.on("data",t=>this.handleCamera(t))):alert("Failed to get camera data!")}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(C.y),a.Y36(c.F0))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-camera"]],viewQuery:function(t,n){if(1&t&&a.Gf(f,5),2&t){let o;a.iGM(o=a.CRH())&&(n.myCanvas=o.first)}},decls:3,vars:0,consts:[[1,"fullscreen"],["myCanvas",""]],template:function(t,n){1&t&&(a.TgZ(0,"div",0),a._UZ(1,"canvas",null,1),a.qZA())},styles:[".fullscreen[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),e})()}];let v=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[c.Bz.forChild(p)],c.Bz]}),e})(),y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[d.ez,v]]}),e})()}}]);