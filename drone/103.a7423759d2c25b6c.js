"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[103],{9103:(S,m,h)=>{h.r(m),h.d(m,{CameraModule:()=>x});var C=h(9808),l=h(4100),a=h(5e3),f=h(4398);const u=["myCanvas"],v=[{path:"",component:(()=>{class e{constructor(t,i){this.clientService=t,this.router=i,this.imageStream=null,this.context2D=null,this.myCanvas={},this.cameraWidth=960,this.cameraHeight=720,this.imageWidth=640,this.imageHeight=640,this.interval=230,this.lastTime=Date.now()}ngOnInit(){this.clientService.connect().then(t=>{console.log("Connect result:",t)}).catch(t=>{alert("Connection error: "+t),this.router.navigate(["/login"])})}updateFps(){let t=Date.now(),i=t-this.lastTime;this.lastTime=t,this.interval=.9*this.interval+i*(1-.9)}handleCamera(t){this.updateFps();let i=t.getImage_asU8(),n=t.getBoxList(),o=new Image,y=new Blob([i],{type:"image/jpeg"});o.src=URL.createObjectURL(y),o.onload=()=>{if(null!==this.context2D){this.context2D.drawImage(o,0,0,this.imageWidth,this.imageHeight,0,0,this.context2D.canvas.width,this.context2D.canvas.height),this.context2D.fillText("FPS: "+(1e3/this.interval).toFixed(2),10,50);for(const r of n){let c=r.getLeft(),d=r.getTop(),w=r.getWidth(),g=r.getHeight();this.context2D.strokeRect(c,d,w,g);let D=r.getConfidence();this.context2D.fillText(Math.round(100*D)+"%",c+5,d+g-6)}URL.revokeObjectURL(o.src)}}}resizeCanvas(t,i){t.style.width="100%",t.style.height="100%";let n=t.offsetWidth,o=t.offsetHeight;n/o>i?t.style.width=Math.floor(o*i)+"px":t.style.height=Math.floor(n/i)+"px"}ngAfterViewInit(){this.myCanvas.nativeElement.width=this.cameraWidth,this.myCanvas.nativeElement.height=this.cameraHeight,this.context2D=this.myCanvas.nativeElement.getContext("2d"),this.resizeCanvas(this.myCanvas.nativeElement,this.cameraWidth/this.cameraHeight),window.addEventListener("resize",()=>this.resizeCanvas(this.myCanvas.nativeElement,this.cameraWidth/this.cameraHeight)),this.context2D&&(this.context2D.strokeStyle="red",this.context2D.lineWidth=3,this.context2D.font="48px Roboto",this.context2D.shadowColor="white",this.context2D.shadowBlur=3,this.context2D.shadowOffsetX=1,this.context2D.shadowOffsetY=1),this.imageStream=this.clientService.getCamera(),null!==this.imageStream?(this.imageStream.on("error",t=>alert("Connection error: "+t)),this.imageStream.on("end",()=>alert("Connection ends.")),this.imageStream.on("data",t=>this.handleCamera(t))):alert("Failed to get camera data!")}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(f.y),a.Y36(l.F0))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-camera"]],viewQuery:function(t,i){if(1&t&&a.Gf(u,5),2&t){let n;a.iGM(n=a.CRH())&&(i.myCanvas=n.first)}},decls:2,vars:0,consts:[[1,"center"],["myCanvas",""]],template:function(t,i){1&t&&a._UZ(0,"canvas",0,1)},styles:[".center[_ngcontent-%COMP%]{position:fixed;border:1px solid;left:50%;transform:translate(-50%)}"]}),e})()}];let p=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[l.Bz.forChild(v)],l.Bz]}),e})(),x=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[C.ez,p]]}),e})()}}]);