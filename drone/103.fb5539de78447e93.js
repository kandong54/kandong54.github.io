(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[103],{9103:(w,D,b)=>{"use strict";b.r(D),b.d(D,{CameraModule:()=>x});var S=b(6895),c=b(3456),z=b(5861),F=b(4302),M=b.n(F),a=b(4650),t=b(3411);const s=["myCanvas"];class o{constructor(e,i){this.clientService=e,this.router=i,this.imageWidth=0,this.imageHeight=0,this.depthSize=0,this.depthFactor=.2,this.imageStream=null,this.lastTime=0,this.context2D=null,this.colors=M()({colormap:"jet",nshades:256,format:"rgba",alpha:255}),this.myCanvas={},this.interval=100}ngOnInit(){this.clientService.connect().then(e=>console.log("Connect result:",e)).catch(e=>{alert("Connection error: "+e),this.router.navigate(["/login"])})}updateFps(){let e=Date.now(),i=e-this.lastTime;this.lastTime=e,this.interval=.95*this.interval+i*(1-.95)}handleCamera(e){this.updateFps();let i=e.getImage_asU8(),n=e.getDepth_asU8(),g=e.getBoxList(),v=new Image;this.depthSize||(this.depthSize=Math.sqrt(n.length));let l=new Blob([i],{type:"image/jpeg"});v.src=URL.createObjectURL(l),v.onload=()=>{if(null===this.context2D)return;let f=this.context2D.createImageData(this.depthSize,this.depthSize);for(let r=0;r<this.depthSize;r++)for(let d=0;d<this.depthSize;d++)f.data[4*(r*this.depthSize+d)]=this.colors[n[r*this.depthSize+d]][0],f.data[4*(r*this.depthSize+d)+1]=this.colors[n[r*this.depthSize+d]][1],f.data[4*(r*this.depthSize+d)+2]=this.colors[n[r*this.depthSize+d]][2],f.data[4*(r*this.depthSize+d)+3]=255;this.context2D.clearRect(0,0,this.context2D.canvas.width,this.context2D.canvas.height),this.context2D.drawImage(v,0,0,this.imageWidth,this.imageHeight,0,0,this.context2D.canvas.width,this.context2D.canvas.height),this.context2D.fillText("FPS: "+(1e3/this.interval).toFixed(2),10,50),this.context2D.lineWidth=3;for(const r of g){let d=r.getLeft(),y=r.getTop(),C=r.getWidth(),p=r.getHeight();this.context2D.strokeRect(d,y,C,p);let W=r.getConfidence(),T=r.getDepth();this.context2D.fillText(Math.round(100*W)+"% "+Math.round(T)+"cm",d+5,y+p-6)}createImageBitmap(f).then(r=>{if(null!==this.context2D){this.context2D.drawImage(r,0,0,this.depthSize,this.depthSize,this.context2D.canvas.width*(1-this.depthFactor),this.context2D.canvas.height*(1-this.depthFactor),this.context2D.canvas.width*this.depthFactor,this.context2D.canvas.height*this.depthFactor),this.context2D.lineWidth=1;for(const d of g){let y=d.getLeft()*this.depthFactor+this.imageWidth*(1-this.depthFactor),C=d.getTop()*this.depthFactor+this.imageHeight*(1-this.depthFactor),p=d.getWidth()*this.depthFactor,W=d.getHeight()*this.depthFactor;this.context2D.strokeRect(y,C,p,W)}}}),URL.revokeObjectURL(v.src)}}resizeCanvas(e,i){let n=window.innerWidth,g=window.innerHeight-e.offsetTop;n/g>i?(e.style.width=Math.floor(g*i)+"px",e.style.height=g+"px"):(e.style.height=Math.floor(n/i)+"px",e.style.width=n+"px")}getImageSize(){var e=this;return(0,z.Z)(function*(){let i=yield e.clientService.getImageSize();if(null===i)throw new Error("Failed to get image size!");[e.imageWidth,e.imageHeight,e.depthSize]=i,e.myCanvas.nativeElement.width=e.imageWidth,e.myCanvas.nativeElement.height=e.imageHeight,e.resizeCanvas(e.myCanvas.nativeElement,e.imageWidth/e.imageHeight),window.addEventListener("resize",()=>e.resizeCanvas(e.myCanvas.nativeElement,e.imageWidth/e.imageHeight))})()}ngAfterViewInit(){var e=this;return(0,z.Z)(function*(){yield e.getImageSize(),e.context2D=e.myCanvas.nativeElement.getContext("2d"),e.context2D&&(e.context2D.strokeStyle="red",e.context2D.lineWidth=3,e.context2D.font="48px Roboto",e.context2D.shadowColor="white",e.context2D.shadowBlur=3,e.context2D.shadowOffsetX=1,e.context2D.shadowOffsetY=1),e.imageStream=e.clientService.getCamera(),null!==e.imageStream?(e.imageStream.on("error",i=>alert("Connection error: "+i)),e.imageStream.on("end",()=>alert("Connection ends.")),e.imageStream.on("data",i=>e.handleCamera(i)),e.lastTime=Date.now()):alert("Failed to get camera data!")})()}static#e=this.\u0275fac=function(i){return new(i||o)(a.Y36(t.y),a.Y36(c.F0))};static#i=this.\u0275cmp=a.Xpm({type:o,selectors:[["app-camera"]],viewQuery:function(i,n){if(1&i&&a.Gf(s,5),2&i){let g;a.iGM(g=a.CRH())&&(n.myCanvas=g.first)}},decls:2,vars:0,consts:[[1,"center"],["myCanvas",""]],template:function(i,n){1&i&&a._UZ(0,"canvas",0,1)},styles:[".center[_ngcontent-%COMP%]{position:fixed;border:1px solid;left:50%;transform:translate(-50%)}"]})}const m=[{path:"",component:o}];class u{static#e=this.\u0275fac=function(i){return new(i||u)};static#i=this.\u0275mod=a.oAB({type:u});static#n=this.\u0275inj=a.cJS({imports:[c.Bz.forChild(m),c.Bz]})}class x{static#e=this.\u0275fac=function(i){return new(i||x)};static#i=this.\u0275mod=a.oAB({type:x});static#n=this.\u0275inj=a.cJS({imports:[S.ez,u]})}},7525:w=>{w.exports={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}},4302:(w,D,b)=>{"use strict";var S=b(7525),c=b(2993);function F(t){return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function M(t){for(var s,o="#",m=0;m<3;++m)o+=("00"+(s=(s=t[m]).toString(16))).substr(s.length);return o}function a(t){return"rgba("+t.join(",")+")"}w.exports=function z(t){var s,o,m,u,x,h,e,i,n,g;if(t||(t={}),i=(t.nshades||72)-1,e=t.format||"hex",(h=t.colormap)||(h="jet"),"string"==typeof h){if(h=h.toLowerCase(),!S[h])throw Error(h+" not a supported colorscale");x=S[h]}else{if(!Array.isArray(h))throw Error("unsupported colormap option",h);x=h.slice()}if(x.length>i+1)throw new Error(h+" map requires nshades to be at least size "+x.length);n=Array.isArray(t.alpha)?2!==t.alpha.length?[1,1]:t.alpha.slice():"number"==typeof t.alpha?[t.alpha,t.alpha]:[1,1],s=x.map(function(d){return Math.round(d.index*i)}),n[0]=Math.min(Math.max(n[0],0),1),n[1]=Math.min(Math.max(n[1],0),1);var v=x.map(function(d,y){var C=x[y].index,p=x[y].rgb.slice();return 4===p.length&&p[3]>=0&&p[3]<=1||(p[3]=n[0]+(n[1]-n[0])*C),p}),l=[];for(g=0;g<s.length-1;++g){u=s[g+1]-s[g],o=v[g],m=v[g+1];for(var f=0;f<u;f++){var r=f/u;l.push([Math.round(c(o[0],m[0],r)),Math.round(c(o[1],m[1],r)),Math.round(c(o[2],m[2],r)),c(o[3],m[3],r)])}}return l.push(x[x.length-1].rgb.concat(n[1])),"hex"===e?l=l.map(M):"rgbaString"===e?l=l.map(a):"float"===e&&(l=l.map(F)),l}},2993:w=>{w.exports=function D(b,S,c){return b*(1-c)+S*c}}}]);